000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. MAINFRAME.
000300 AUTHOR. COQU-TEST.
000400*
000500* Sample mainframe-format COBOL with sequence numbers
000600*
000700 ENVIRONMENT DIVISION.
000800 INPUT-OUTPUT SECTION.
000900 FILE-CONTROL.
001000     SELECT MASTER-FILE ASSIGN TO MASTERIN.
001100
001200 DATA DIVISION.
001300 FILE SECTION.
001400 FD MASTER-FILE.
001500 01 MASTER-RECORD.
001600    05 MR-KEY              PIC X(10).
001700    05 MR-DATA             PIC X(80).
001800
001900 WORKING-STORAGE SECTION.
002000 01 WS-WORK-AREAS.
002100    05 WS-EOF-FLAG         PIC 9 VALUE 0.
002200       88 WS-EOF           VALUE 1.
002300    05 WS-COUNT            PIC 9(7) VALUE 0.
002400
002500 01 WS-SQL-AREA.
002600    EXEC SQL INCLUDE SQLCA END-EXEC.
002700
002800 COPY COMAREA.
002900
003000 LINKAGE SECTION.
003100 01 DFHCOMMAREA            PIC X(100).
003200
003300 PROCEDURE DIVISION.
003400
003500 0000-MAIN.
003600     PERFORM 1000-INITIALIZE
003700     PERFORM 2000-PROCESS UNTIL WS-EOF
003800     PERFORM 9000-TERMINATE
003900     GOBACK.
004000
004100 1000-INITIALIZE.
004200     OPEN INPUT MASTER-FILE
004300     EXEC SQL
004400         SELECT COUNT(*) INTO :WS-COUNT
004500         FROM EMPLOYEE_TABLE
004600     END-EXEC
004700     PERFORM 1100-READ-FIRST.
004800
004900 1100-READ-FIRST.
005000     READ MASTER-FILE
005100         AT END SET WS-EOF TO TRUE
005200     END-READ.
005300
005400 2000-PROCESS.
005500     ADD 1 TO WS-COUNT
005600     PERFORM 2100-VALIDATE
005700     PERFORM 2200-UPDATE-DB
005800     READ MASTER-FILE
005900         AT END SET WS-EOF TO TRUE
006000     END-READ.
006100
006200 2100-VALIDATE.
006300     IF MR-KEY = SPACES
006400         MOVE 'INVALID' TO MR-DATA
006500     END-IF.
006600
006700 2200-UPDATE-DB.
006800     EXEC SQL
006900         UPDATE EMPLOYEE_TABLE
007000         SET LAST_ACCESS = CURRENT TIMESTAMP
007100         WHERE EMP_KEY = :MR-KEY
007200     END-EXEC
007300     EXEC CICS
007400         WRITEQ TS QUEUE('AUDITQ')
007500         FROM(MR-DATA)
007600         LENGTH(80)
007700     END-EXEC.
007800
007900 9000-TERMINATE.
008000     CLOSE MASTER-FILE
008100     DISPLAY 'PROCESSED: ' WS-COUNT ' RECORDS'.
